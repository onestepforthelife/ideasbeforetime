ðŸš€ GODA AI - COMPLETE SOLUTION (REST API)
==========================================

YOUR ACCOUNT ID: ec0e231cd7a2cde41590c6e8272cc78c

SOLUTION: Call Workers AI REST API directly from browser
- No Worker needed
- Just need API token
- Completely FREE
- Works immediately

STEP 1: CREATE API TOKEN
=========================
1. Go to: https://dash.cloudflare.com/profile/api-tokens
2. Click: "Create Token"
3. Click: "Create Custom Token"
4. Token name: "GODA AI"
5. Permissions:
   - Account â†’ Workers AI â†’ Read
6. Click: "Continue to summary"
7. Click: "Create Token"
8. COPY THE TOKEN (save it securely)

STEP 2: UPDATE GODA CHATBOT CODE
=================================

Replace the getBotResponse function in goda-chatbot.js:

```javascript
async function getBotResponse(message) {
    // Check for numbered input first
    const numberedResponse = handleNumberedInput(message);
    if (numberedResponse) {
        conversationHistory.push(
            { role: 'user', text: message },
            { role: 'assistant', text: numberedResponse }
        );
        return numberedResponse;
    }
    
    try {
        // Show typing indicator
        const typingDiv = document.createElement('div');
        typingDiv.className = 'message bot-message typing-indicator';
        typingDiv.innerHTML = `
            <img src="images/logo Goda 40 bs 32 pixel.jpg" alt="GODA" class="message-avatar-img">
            <div class="message-content">
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
            </div>
        `;
        messages.appendChild(typingDiv);
        messages.scrollTop = messages.scrollHeight;

        // Build conversation context
        const systemPrompt = "You are GODA, a helpful AI assistant for onestepforthelife.com. Help users with Kiro IDE, AI learning, site navigation, and general questions. Be concise and friendly.";
        
        const apiMessages = [
            { role: "system", content: systemPrompt }
        ];
        
        // Add conversation history (last 3 exchanges)
        if (conversationHistory.length > 0) {
            conversationHistory.slice(-6).forEach(msg => {
                apiMessages.push({
                    role: msg.role === 'user' ? 'user' : 'assistant',
                    content: msg.text
                });
            });
        }
        
        // Add current message
        apiMessages.push({ role: "user", content: message });

        // Call Cloudflare Workers AI REST API
        const response = await fetch(
            'https://api.cloudflare.com/client/v4/accounts/ec0e231cd7a2cde41590c6e8272cc78c/ai/run/@cf/meta/llama-3-8b-instruct',
            {
                method: 'POST',
                headers: {
                    'Authorization': 'Bearer YOUR_API_TOKEN_HERE',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    messages: apiMessages
                })
            }
        );

        // Remove typing indicator
        typingDiv.remove();

        if (!response.ok) {
            const errorData = await response.json();
            console.error('API Error:', errorData);
            return 'Sorry, I\'m having trouble right now. Please try again.';
        }

        const data = await response.json();
        const aiResponse = data.result.response;
        
        // Update conversation history
        conversationHistory.push(
            { role: 'user', text: message },
            { role: 'assistant', text: aiResponse }
        );

        // Keep only last 10 messages (5 exchanges)
        if (conversationHistory.length > 10) {
            conversationHistory = conversationHistory.slice(-10);
        }

        return aiResponse;

    } catch (error) {
        console.error('Chat error:', error);
        
        // Fallback to simple responses if API fails
        const msg = message.toLowerCase();
        
        if (msg.includes('kiro') || msg.includes('error')) {
            return 'For Kiro IDE issues, check out our <a href="kiro.html">troubleshooting guide</a>.';
        }
        if (msg.includes('tool')) {
            return 'Find all tools at <a href="tools.html">Tools Hub</a>: SPO, Job Search, RO Guide.';
        }
        if (msg.includes('report') || msg.includes('market')) {
            return 'Check <a href="market-reports.html">Chemical Market Reports</a> for insights.';
        }
        if (msg.includes('blog')) {
            return 'We have 100+ posts on <a href="blog.html">Leadership & Technology</a>.';
        }
        
        return 'I\'m having connection issues. Try: <a href="tools.html">Tools</a> | <a href="blog.html">Blog</a> | <a href="market-reports.html">Reports</a>';
    }
}
```

STEP 3: SECURE THE API TOKEN
=============================

OPTION A: Use Cloudflare Worker (Recommended)
----------------------------------------------
Create a simple proxy Worker to hide the token:

```javascript
export default {
  async fetch(request, env) {
    if (request.method === 'OPTIONS') {
      return new Response(null, {
        headers: {
          'Access-Control-Allow-Origin': '*',
          'Access-Control-Allow-Methods': 'POST, OPTIONS',
          'Access-Control-Allow-Headers': 'Content-Type',
        }
      });
    }

    try {
      const { messages } = await request.json();
      
      const response = await fetch(
        'https://api.cloudflare.com/client/v4/accounts/ec0e231cd7a2cde41590c6e8272cc78c/ai/run/@cf/meta/llama-3-8b-instruct',
        {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${env.WORKERS_AI_TOKEN}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ messages })
        }
      );

      const data = await response.json();

      return new Response(JSON.stringify({
        response: data.result.response
      }), {
        headers: {
          'Content-Type': 'application/json',
          'Access-Control-Allow-Origin': '*'
        }
      });

    } catch (error) {
      return new Response(JSON.stringify({
        fallback: 'Sorry, I\'m having trouble right now.',
        error: error.message
      }), {
        status: 500,
        headers: {
          'Content-Type': 'application/json',
          'Access-Control-Allow-Origin': '*'
        }
      });
    }
  }
};
```

Then update goda-chatbot.js to call your Worker:
```javascript
const response = await fetch('https://orange-lab-a038.onestepforthelife.workers.dev', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ messages: apiMessages })
});
```

OPTION B: Environment Variable (Less Secure)
---------------------------------------------
Store token in a config file (not recommended for production)

STEP 4: DEPLOY WORKER
======================
1. Go to: https://dash.cloudflare.com
2. Workers & Pages â†’ Create Application
3. Create Worker â†’ Name: orange-lab-a038
4. Paste Worker code above
5. Settings â†’ Variables â†’ Add:
   - Name: WORKERS_AI_TOKEN
   - Value: [Your API token]
   - Type: Secret
6. Save and Deploy

STEP 5: TEST
============
Open browser console and run:

```javascript
fetch('https://orange-lab-a038.onestepforthelife.workers.dev', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
        messages: [
            { role: 'system', content: 'You are GODA AI assistant' },
            { role: 'user', content: 'Hello!' }
        ]
    })
})
.then(r => r.json())
.then(d => console.log('Response:', d))
.catch(e => console.error('Error:', e));
```

Expected:
{
    "response": "Hello! I'm GODA, your AI assistant..."
}

COST BREAKDOWN:
===============
âœ… Workers AI API: FREE
âœ… Cloudflare Worker: FREE (100,000 requests/day)
âœ… Total cost: $0.00

RATE LIMITS:
============
- Workers AI: Fair use (no hard limit)
- Worker: 100,000 requests/day (FREE tier)
- More than enough for your site

NEXT STEPS:
===========
1. Create API token (Step 1)
2. Deploy Worker with token (Step 4)
3. Update goda-chatbot.js to call Worker
4. Test in browser console
5. GODA will work perfectly!

FILES TO UPDATE:
================
1. goda-chatbot.js - Update getBotResponse function
2. Deploy Worker - orange-lab-a038.onestepforthelife.workers.dev

STATUS: Ready to implement
PRIORITY: HIGH
COST: $0.00 (FREE!)
TIME: 10 minutes
