ðŸ¤– GODA AI TROUBLESHOOTING - December 8, 2025
================================================

ISSUE: GODA AI chatbot not responding

WHAT I CHECKED:
âœ… goda-chatbot.js code is correct
âœ… Worker URL is correct: orange-lab-a038.onestepforthelife.workers.dev
âœ… Chatbot loads on pages
âœ… UI works (toggle, input, send button)

LIKELY CAUSES:
1. Cloudflare Worker not deployed
2. API key not configured in Worker
3. CORS not enabled in Worker
4. Worker code has errors

HOW TO FIX:
============

STEP 1: Check Worker Status
----------------------------
1. Go to: https://dash.cloudflare.com
2. Click: Workers & Pages
3. Find: orange-lab-a038
4. Check: Is it deployed? (green checkmark)
5. Check: Last deployment time

STEP 2: Check Worker Code
--------------------------
1. Click on Worker name
2. Click: "Quick Edit" button
3. Verify code includes:
   - Gemini API call
   - CORS headers
   - Error handling
4. Check environment variables:
   - GEMINI_API_KEY is set

STEP 3: Test Worker Directly
-----------------------------
Open browser console and run:

```javascript
fetch('https://orange-lab-a038.onestepforthelife.workers.dev', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
        message: 'test',
        conversationHistory: []
    })
})
.then(r => r.json())
.then(d => console.log('Response:', d))
.catch(e => console.error('Error:', e));
```

Expected response:
{
    "response": "AI response here",
    "model": "gemini-pro"
}

STEP 4: Check Worker Logs
--------------------------
1. In Cloudflare Dashboard
2. Click: Worker name
3. Click: "Logs" tab
4. Click: "Begin log stream"
5. Try chatbot
6. See errors in real-time

COMMON ERRORS:
==============

Error 1: "Worker not found"
â†’ Worker not deployed
â†’ Fix: Deploy Worker from dashboard

Error 2: "API key not configured"
â†’ GEMINI_API_KEY not set
â†’ Fix: Add environment variable in Worker settings

Error 3: "CORS error"
â†’ CORS headers missing
â†’ Fix: Add CORS headers to Worker response:
   'Access-Control-Allow-Origin': '*'
   'Access-Control-Allow-Methods': 'POST, OPTIONS'
   'Access-Control-Allow-Headers': 'Content-Type'

Error 4: "Rate limit exceeded"
â†’ Too many requests to Gemini API
â†’ Fix: Wait or upgrade API plan

WORKER CODE TEMPLATE:
=====================

```javascript
export default {
  async fetch(request, env) {
    // Handle CORS preflight
    if (request.method === 'OPTIONS') {
      return new Response(null, {
        headers: {
          'Access-Control-Allow-Origin': '*',
          'Access-Control-Allow-Methods': 'POST, OPTIONS',
          'Access-Control-Allow-Headers': 'Content-Type',
        }
      });
    }

    try {
      const { message, conversationHistory } = await request.json();
      
      // Call Gemini API
      const response = await fetch(
        `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${env.GEMINI_API_KEY}`,
        {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            contents: [{
              parts: [{ text: message }]
            }]
          })
        }
      );

      const data = await response.json();
      const aiResponse = data.candidates[0].content.parts[0].text;

      return new Response(JSON.stringify({
        response: aiResponse,
        model: 'gemini-pro'
      }), {
        headers: {
          'Content-Type': 'application/json',
          'Access-Control-Allow-Origin': '*'
        }
      });

    } catch (error) {
      return new Response(JSON.stringify({
        fallback: 'Sorry, I\'m having trouble right now. Please try again.',
        error: error.message
      }), {
        status: 500,
        headers: {
          'Content-Type': 'application/json',
          'Access-Control-Allow-Origin': '*'
        }
      });
    }
  }
};
```

QUICK TEST:
===========
1. Open any page with GODA chatbot
2. Click GODA button
3. Type: "test"
4. Press Send
5. Open browser console (F12)
6. Check for errors

If you see:
- "Failed to fetch" â†’ Worker not deployed or wrong URL
- "CORS error" â†’ CORS not configured
- "500 error" â†’ Worker code error (check logs)
- No response â†’ API key not configured

NEXT STEPS:
===========
1. Check Worker is deployed
2. Verify API key is set
3. Test Worker directly
4. Check logs for errors
5. Fix based on error message

STATUS: Ready to troubleshoot
PRIORITY: HIGH - User is frustrated
